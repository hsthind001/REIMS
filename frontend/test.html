<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>REIMS Analytics Test</title>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/recharts@2.15.4/umd/Recharts.js"></script>
    <script src="https://unpkg.com/babel-standalone@6/babel.min.js"></script>
    <style>
        body { 
            font-family: Arial, sans-serif; 
            margin: 0; 
            padding: 20px; 
            background-color: #f5f5f5; 
        }
        .container { 
            max-width: 1200px; 
            margin: 0 auto; 
            background: white; 
            padding: 20px; 
            border-radius: 8px; 
            box-shadow: 0 2px 10px rgba(0,0,0,0.1); 
        }
        .nav { 
            display: flex; 
            gap: 10px; 
            margin-bottom: 20px; 
            border-bottom: 1px solid #eee; 
            padding-bottom: 10px; 
        }
        .nav-button { 
            padding: 10px 20px; 
            border: none; 
            background: #e5e7eb; 
            cursor: pointer; 
            border-radius: 4px; 
        }
        .nav-button.active { 
            background: #3b82f6; 
            color: white; 
        }
        .overview-grid { 
            display: grid; 
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); 
            gap: 20px; 
            margin-bottom: 30px; 
        }
        .overview-card { 
            background: #f8fafc; 
            padding: 20px; 
            border-radius: 8px; 
            border-left: 4px solid #3b82f6; 
        }
        .overview-card h3 { 
            margin: 0 0 10px 0; 
            color: #1f2937; 
        }
        .overview-card .value { 
            font-size: 2em; 
            font-weight: bold; 
            color: #3b82f6; 
        }
        .chart-container { 
            background: white; 
            border: 1px solid #e5e7eb; 
            border-radius: 8px; 
            padding: 20px; 
            margin-bottom: 20px; 
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { PieChart, Pie, Cell, BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend, ResponsiveContainer } = Recharts;

        const COLORS = ['#0088FE', '#00C49F', '#FFBB28', '#FF8042', '#8884D8'];

        function Navigation({ currentView, setCurrentView }) {
            return (
                <div className="nav">
                    <button 
                        className={`nav-button ${currentView === 'upload' ? 'active' : ''}`}
                        onClick={() => setCurrentView('upload')}
                    >
                        ðŸ“¤ Upload
                    </button>
                    <button 
                        className={`nav-button ${currentView === 'documents' ? 'active' : ''}`}
                        onClick={() => setCurrentView('documents')}
                    >
                        ðŸ“„ Documents
                    </button>
                    <button 
                        className={`nav-button ${currentView === 'analytics' ? 'active' : ''}`}
                        onClick={() => setCurrentView('analytics')}
                    >
                        ðŸ“Š Analytics
                    </button>
                </div>
            );
        }

        function AnalyticsDashboard() {
            const [overview, setOverview] = useState(null);
            const [loading, setLoading] = useState(true);
            const [error, setError] = useState(null);

            useEffect(() => {
                fetchAnalyticsData();
            }, []);

            const fetchAnalyticsData = async () => {
                try {
                    setLoading(true);
                    
                    const overviewResponse = await fetch("http://localhost:8000/api/analytics/overview");
                    if (!overviewResponse.ok) {
                        throw new Error(`HTTP error! status: ${overviewResponse.status}`);
                    }
                    const overviewData = await overviewResponse.json();
                    setOverview(overviewData);
                    
                    setError(null);
                } catch (err) {
                    console.error("Error fetching analytics data:", err);
                    setError(err.message);
                } finally {
                    setLoading(false);
                }
            };

            if (loading) {
                return <div>Loading analytics...</div>;
            }

            if (error) {
                return (
                    <div>
                        <h2>Analytics Dashboard</h2>
                        <div style={{color: 'red'}}>
                            Error loading analytics: {error}
                        </div>
                        <button onClick={fetchAnalyticsData}>Retry</button>
                    </div>
                );
            }

            if (!overview) {
                return <div>No analytics data available</div>;
            }

            return (
                <div>
                    <h2>Analytics Dashboard</h2>
                    
                    <div className="overview-grid">
                        <div className="overview-card">
                            <h3>Total Documents</h3>
                            <div className="value">{overview.total_documents}</div>
                        </div>
                        
                        <div className="overview-card">
                            <h3>Processing Jobs</h3>
                            <div className="value">{overview.total_jobs}</div>
                        </div>
                        
                        <div className="overview-card">
                            <h3>Extracted Records</h3>
                            <div className="value">{overview.total_records}</div>
                        </div>
                        
                        <div className="overview-card">
                            <h3>Storage Used</h3>
                            <div className="value">{Math.round(overview.total_size / 1024)} KB</div>
                        </div>
                    </div>

                    <div className="chart-container">
                        <h3>Document Types Distribution</h3>
                        <p>File types: {overview.file_types ? Object.keys(overview.file_types).join(', ') : 'None'}</p>
                        <p>Status distribution: {overview.status_distribution ? Object.keys(overview.status_distribution).join(', ') : 'None'}</p>
                    </div>
                </div>
            );
        }

        function App() {
            const [currentView, setCurrentView] = useState('analytics');

            return (
                <div className="container">
                    <h1>REIMS - Real Estate Information Management System</h1>
                    <Navigation currentView={currentView} setCurrentView={setCurrentView} />
                    
                    {currentView === 'analytics' && <AnalyticsDashboard />}
                    {currentView === 'upload' && <div><h2>Document Upload</h2><p>Upload functionality coming soon...</p></div>}
                    {currentView === 'documents' && <div><h2>Document List</h2><p>Document listing coming soon...</p></div>}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>